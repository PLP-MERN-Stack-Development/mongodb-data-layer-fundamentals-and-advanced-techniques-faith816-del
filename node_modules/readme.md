// ==========================
// MongoDB Week 1 – Submission
// ==========================

// ===== Task 3: Advanced Queries =====

// 3.1 In stock AND published after 2010
db.books.find({
  $and: [
    { inStock: true },
    { publishedYear: { $gt: 2010 } }
  ]
})
// Screenshot: Screenshot1_Task3_1_filter.png

// 3.2 Projection: show only title and author
db.books.find(
  {
    $and: [
      { inStock: true },
      { publishedYear: { $gt: 2010 } }
    ]
  },
  { title: 1, author: 1, _id: 0 }
)
// Screenshot: Screenshot2_Task3_2_projection.png

// 3.3 Sorting ascending & descending by title
// Ascending
db.books.find().sort({ title: 1 })
// Screenshot: Screenshot3_Task3_3_sort_asc.png

// Descending
db.books.find().sort({ title: -1 })
// Screenshot: Screenshot4_Task3_3_sort_desc_or_pagination.png

// 3.4 Pagination (limit & skip)
// Page 1 → first 5 documents
db.books.find().limit(5)
// Screenshot: Screenshot4_Task3_3_sort_desc_or_pagination.png

// Page 2 → next 5 documents
db.books.find().skip(5).limit(5)
// Screenshot: Screenshot4_Task3_3_sort_desc_or_pagination.png

// ===== Task 4: Aggregation Pipeline =====

// 4.1 Average price of books per genre
db.books.aggregate([
  {
    $group: {
      _id: "$genre",
      averagePrice: { $avg: "$price" }
    }
  }
])
// Screenshot: [No new screenshot needed]

// 4.2 Author with the most books
db.books.aggregate([
  {
    $group: {
      _id: "$author",
      count: { $sum: 1 }
    }
  },
  { $sort: { count: -1 } },
  { $limit: 1 }
])
// Screenshot: [No new screenshot needed]

// 4.3 Group books by publication decade and count
db.books.aggregate([
  {
    $group: {
      _id: { $multiply: [ { $floor: { $divide: ["$publishedYear", 10] } }, 10 ] },
      count: { $sum: 1 }
    }
  },
  { $sort: { _id: 1 } }
])
// Screenshot: [No new screenshot needed]

// ===== Task 5: Indexing =====

// 5.1 Compound index on author + published-year
db.books.createIndex({ author: 1, publishedYear: 1 })
// Screenshot: Screenshot5_Task5_index.png

// 5.2 Method to demonstrate performance improvement
// 1. Run a query on author + publishedYear BEFORE creating the index.
// 2. Create the compound index (see query above).
// 3. Run the same query AFTER creating the index — execution should be faster.
// 4. Optional: Use "Execution Stats" in Atlas to show the difference.
// Screenshot: Screenshot5_Task5_index.pngc:\Users\user\Downloads\Screenshot_2-10-2025_18241_cloud.mongodb.com.jpeg